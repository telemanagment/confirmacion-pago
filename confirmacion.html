<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Confirmando Pago</title>
  <script>
    async function confirmarPago() {
      const urlParams = new URLSearchParams(window.location.search);
      const idFactura = urlParams.get("idFactura");
      const cedula = urlParams.get("cedula");
      const nombre = urlParams.get("nombre");

      // Verifica si los parámetros están presentes
      if (idFactura && cedula && nombre) {
        // Llama a tu aplicación local para marcar como pagado y enviar notificación
        // Aquí debes reemplazar por tu propio servidor o listener en VB.NET
        await fetch("http://localhost:8080/confirmar?idFactura=" + idFactura + "&cedula=" + cedula + "&nombre=" + nombre)
          .then(response => {
            if (response.ok) {
              console.log("Confirmado");
              alert("✅ Pago confirmado y factura procesada.");
            } else {
              console.error("Error al procesar la factura.");
            }
          })
          .catch(error => console.error("Error:", error));
      } else {
        alert("❌ Faltan parámetros. No se pudo confirmar el pago.");
      }

      // Cierra la ventana automáticamente después de 2 segundos
      setTimeout(() => window.close(), 2000);
    }

    window.onload = confirmarPago;
  </script>
</head>
<body>
  <h3>Confirmando pago...</h3>
</body>
</html>
