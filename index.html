<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Confirmando Pago</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      background-color: #f8f8f8;
      color: #333;
    }
    .status {
      font-size: 1.2em;
      margin-top: 20px;
    }
  </style>
  <script>
    async function confirmarPago() {
      const urlParams = new URLSearchParams(window.location.search);
      const idFactura = urlParams.get("idFactura");
      const cedula = urlParams.get("cedula");
      const nombre = urlParams.get("nombre");

      const estado = document.getElementById("estado");

      if (idFactura && cedula && nombre) {
        estado.innerText = "üîÑ Procesando confirmaci√≥n de pago...";

        try {
          const response = await fetch(`http://localhost:8080/confirmar?idFactura=${idFactura}&cedula=${cedula}&nombre=${encodeURIComponent(nombre)}`);

          if (response.ok) {
            estado.innerText = "‚úÖ Pago confirmado correctamente.";
          } else {
            estado.innerText = "‚ùå Error al confirmar el pago.";
          }
        } catch (error) {
          estado.innerText = "‚ö†Ô∏è No se pudo conectar con la aplicaci√≥n local. ¬øEst√° abierta?";
        }

        setTimeout(() => window.close(), 2000);
      } else {
        estado.innerText = "‚ùå Faltan par√°metros en la URL.";
      }
    }

    window.onload = confirmarPago;
  </script>
</head>
<body>
  <h2>Confirmaci√≥n de Pago</h2>
  <div class="status" id="estado">üîç Verificando datos...</div>
</body>
</html>
